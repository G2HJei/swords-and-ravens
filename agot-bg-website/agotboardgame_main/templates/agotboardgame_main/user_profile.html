{% extends "./base.html" %}

{% block title %}
{{ viewed_user.username }} -
{% endblock %}

{% load humanize %}

{% block content %}
<div class="row decrease-container-margin">
    <div class="col">
        <h3 class="mb-4">{% if group_name %}<span class="badge badge badge-{{ group_color }}">{{ group_name }}</span>{% endif %} {{ viewed_user.username }}</h3>
    </div>
</div>
<div class="row decrease-container-margin">
    <div class="col-lg-3">
        <div class="card">
            <div class="card-body">
                <table class="table middle-aligned">
                    <tr>
                        <td class="fitwidth">
                            <b>Last activity</b>
                        </td>
                        <td>
                            {{ viewed_user.last_activity|naturaltime}}
                        </td>
                    </tr>
                    <tr>
                        <td class="fitwidth">
                            <b>Joined on</b>
                        </td>
                        <td>
                            {{ viewed_user.date_joined|date:"M d, Y" }}
                        </td>
                    </tr>
                    <tr>
                        <td class="fitwidth">
                            <b>Ongoing games</b>
                        </td>
                        <td>
                            {{ viewed_user.ongoing_count }}
                        </td>
                    </tr>
                    <tr>
                        <td class="fitwidth">
                            <b>Finished games</b>
                        </td>
                        <td>
                            {{ viewed_user.finished_count }}
                        </td>
                    </tr>
                    <tr>
                        <td class="fitwidth">
                            <b>Won games</b>
                        </td>
                        <td>
                            {{ viewed_user.won_count }}
                        </td>
                    </tr>
                    <tr>
                        <td class="fitwidth">
                            <b>Win rate</b>
                        </td>
                        <td>
                            {{ viewed_user.win_rate }}
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <b>Average PBEM<br/>response time</b>
                        </td>
                        <td>
                            {{ viewed_user.average_pbem_speed }}
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    <div class="col-lg-5">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title">Games</h4>
                <table class="table table-hover table-sm middle-aligned">
                    {% for player in viewed_user.games_of_user %}
                        <tr>
                            <td class="text-center" style="width: 75px">
                                {% if player.game.state == "IN_LOBBY" %}
                                    <span class="badge badge-pill badge-success">Open</span>
                                {% elif player.game.state == "ONGOING" %}
                                    <span class="badge badge-pill badge-warning">Ongoing</span>
                                {% elif player.game.state == "CANCELLED" %}
                                    <span class="badge badge-pill badge-danger">Cancelled</span>
                                {% elif player.has_won %}
                                    <i class="fas fa-crown"></i>
                                {% endif %}
                            </td>
                            <td>
                                {{ player.game.name }}
                            </td>
                            <td style="width: 1px">
                                <a class="btn btn-primary btn-sm"
                                   href="/play/{{ player.game.id }}"
                                   target="_blank"
                                >
                                    Join
                                </a>
                            </td>
                            {% if perms.agotboardgame_main.can_play_as_another_player %}
                                <td style="width: 70px">
                                    <a class="btn btn-primary btn-sm"
                                       href="/play/{{ player.game.id }}/{{ viewed_user.id }}"
                                       target="_blank"
                                    >
                                        Join as
                                    </a>
                                </td>
                            {% endif %}
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="4" class="text-center">No games</td>
                        </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
    </div>
    <div class="col-lg-4">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title">Cancelled Games</h4>
                <table class="table table-hover table-sm middle-aligned">
                    {% for player in viewed_user.cancelled_games %}
                        <tr>
                            <td>
                                {{ player.game.name }}
                            </td>
                            <td style="width: 1px">
                                <a class="btn btn-primary btn-sm"
                                   href="/play/{{ player.game.id }}"
                                   target="_blank"
                                >
                                    Join
                                </a>
                            </td>
                            {% if perms.agotboardgame_main.can_play_as_another_player %}
                                <td style="width: 70px">
                                    <a class="btn btn-primary btn-sm"
                                       href="/play/{{ player.game.id }}/{{ viewed_user.id }}"
                                       target="_blank"
                                    >
                                        Join as
                                    </a>
                                </td>
                            {% endif %}
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="4" class="text-center">No cancelled games</td>
                        </tr>
                    {% endfor %}
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}
